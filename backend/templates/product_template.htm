{% extends 'template.htm' %}

{% block h1_title %}Products{% endblock %}

{% block content %}
<div class="modal fade" id="product-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Produkt-Info</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
            
            
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="table-responsive">
    <table class="table table-striped table-sm" id="table-products">
        <thead>
            <tr>
                <th>Artikelnummer</th>
                <th>Titel</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>      
 
{% endblock %}

{% block javascript %}
<script type="text/javascript">
    var products = {{products | safe}};
    var file_config = {{file_config | safe}};

    function show_product(el){
      let product = products[el];
      let html = '<table class="table table-sm">';
      for(let col in product){
        html += '<tr><th>'+col+'</th>';
        html += '<td>'+product[col]+'</td></tr>';
      }
      html += '</table>';
      
      $('#product-modal .modal-body form').html(html);      
      $('#product-modal').modal('show');
    }

    function get_id(){
      for(col in file_config){
        if(file_config[col]['column'] == 'id'){
          return file_config[col]['name'];
        }
      }
      return false;
    }

    function get_title(){
      for(col in file_config){
        if(file_config[col]['column'] == 'title'){
          return file_config[col]['name'];
        }
      }
      return false;
    }
    
    function redraw_table(){
      $('#table-products tbody').html('');

      for(let i in products){
        let product = products[i];
        let html = '<tr><td>'+product[col_id]+"</td><td>"+product[col_title]+"</td>";
        html += '<td><span data-feather="shopping-cart" onclick="show_product('+i+')" style="cursor: pointer;"></span></td></tr>';
        $('#table-products tbody').append(html);
      }
      feather.replace();
    }

    var col_id = false;
    var col_title = false;

    $(document).ready(function(){
      col_id = get_id();
      col_title = get_title();
      redraw_table();
    })
</script>          
{% endblock %}